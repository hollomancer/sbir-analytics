# .env.example.staging
# Staging-friendly environment template for CET classification + SBIR ETL stack.
# Copy to ".env" and customize. Do NOT commit your real secrets.
#
# Usage:
#   cp .env.example.staging .env
#   # edit values below
#   docker compose -f docker-compose.cet-staging.yml up -d
#
# Notes:
# - The staging Compose file will start Neo4j + Dagster webserver + Dagster daemon.
# - CET model artifact should be present at ./artifacts/models/cet_classifier_v1.pkl
#   on the host, or point CET_MODEL_PATH at your artifact inside the container.

###############################################################################
# Core environment
###############################################################################
# Logical environment label used by the app
ENVIRONMENT=staging

# How long services will wait for dependencies (seconds)
SERVICE_STARTUP_TIMEOUT=120

# Container image controls (optional)
IMAGE_NAME=sbir-etl
IMAGE_TAG=staging

# Dagster UI
DAGSTER_PORT=3000
# Endpoint used by healthcheck in compose
DAGSTER_HEALTH_PATH=/server_info

# Optional: override the command run by the Dagster webserver container
#ENV_DAGSTER_CMD=dagster-webserver -h 0.0.0.0 -p 3000

###############################################################################
# Neo4j configuration
###############################################################################
# When using the built-in Neo4j service from docker-compose.cet-staging.yml:
NEO4J_HTTP_PORT=7474
NEO4J_BOLT_PORT=7687

# Credentials for BOTH the Neo4j container and the app clients
NEO4J_USER=neo4j
NEO4J_PASSWORD=replace_me_staging  # pragma: allowlist secret
NEO4J_DATABASE=neo4j

# Optional (for Neo4j container only). If set, it overrides NEO4J_USER/PASSWORD for the container:
#NEO4J_AUTH=neo4j/replace_me_staging

# App clients connect via a URI. Default points to the compose service.
# For a managed/external Neo4j, replace hostname and (optionally) port:
#   NEO4J_URI=bolt://your-staging-neo4j.myorg.internal:7687
NEO4J_URI=bolt://neo4j:7687

# Some modules still read host/port from these keys; safe to keep aligned:
SBIR_ETL__NEO4J__HOST=neo4j
SBIR_ETL__NEO4J__PORT=7687

###############################################################################
# CET model + runtime knobs
###############################################################################
# Path inside the container to the trained CET classifier artifact.
# The staging compose bind-mounts ./artifacts -> /app/artifacts (read/write).
CET_MODEL_PATH=/app/artifacts/models/cet_classifier_v1.pkl

# Human sampling defaults for small manual QA sets
SBIR_ETL__CET__SAMPLE_SIZE=50
SBIR_ETL__CET__SAMPLE_SEED=42

# CET drift detection thresholds (Jensenâ€“Shannon divergence)
SBIR_ETL__CET__DRIFT__SCORE_JS_THRESHOLD=0.15
SBIR_ETL__CET__DRIFT__LABEL_JS_THRESHOLD=0.10

###############################################################################
# Dagster schedules (cron, UTC). Defaults match prod cadence.
###############################################################################
# Full SBIR ETL (all assets)
SBIR_ETL__DAGSTER__SCHEDULES__ETL_JOB=0 2 * * *
# CET end-to-end pipeline
SBIR_ETL__DAGSTER__SCHEDULES__CET_FULL_PIPELINE_JOB=0 2 * * *
# CET drift detection and alerting
SBIR_ETL__DAGSTER__SCHEDULES__CET_DRIFT_JOB=0 6 * * *

###############################################################################
# Optional: USPTO AI / other modules (uncomment if you use these in staging)
###############################################################################
#SBIR_ETL__USPTO_AI__RAW_DIR=/app/data/raw/USPTO
#SBIR_ETL__USPTO_AI__DUCKDB=/app/data/processed/uspto_ai.duckdb
#SBIR_ETL__USPTO_AI__PROCESSED_DIR=/app/data/processed
#SBIR_ETL__USPTO__TRANSFORM_DIR=/app/data/transformed/uspto

###############################################################################
# Security & operations reminders
###############################################################################
# - Change NEO4J_PASSWORD to a strong value before first run.
# - Do not commit .env with real secrets.
# - If pointing to external Neo4j, open firewall for Bolt (default 7687) and
#   confirm the DB name matches NEO4J_DATABASE (or leave default 'neo4j').
# - Ensure the CET model file exists at CET_MODEL_PATH or update the path.
# - Validate outputs after running:
#     data/processed/*.checks.json
#     reports/alerts/*.json
#   and run Neo4j Cypher spot checks per docs/deployment/cet-assets-deployment.md.

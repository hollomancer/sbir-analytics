repos:
  # Standard file checks (good practice for all files)
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-yaml
      - id: check-added-large-files
      - id: end-of-file-fixer
      - id: trailing-whitespace

  # Python linting and formatting (matches CI scope: src and tests)
  # CI equivalent: ruff check src tests && ruff format --check src tests
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.4
    hooks:
      - id: ruff
        files: ^(src|tests)/
        args: [--fix, --exit-non-zero-on-fix]
      - id: ruff-format
        files: ^(src|tests)/

  # Type checking (matches CI scope: src only)
  # CI equivalent: mypy src
  # Note: mypy is configured in pyproject.toml with exclude patterns for
  # scripts/, tests/, examples/, and migrations/ to match this scope
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.18.2
    hooks:
      - id: mypy
        files: ^src/
        args: [--config-file=pyproject.toml]
        additional_dependencies:
          [
            pandas-stubs,
            types-psutil,
            types-PyYAML,
            types-tqdm,
            types-requests,
            "boto3-stubs[s3]",
            pydantic,
          ]

# Security scanning (bandit and detect-secrets) moved to nightly CI only
# Run manually with: uv run bandit -r src -c pyproject.toml
# Run manually with: uv run detect-secrets scan --baseline .secrets.baseline

# Configuration notes for maintainers:
#
# SCOPE ALIGNMENT WITH CI:
#   This pre-commit configuration is designed to match the CI workflow
#   defined in .github/workflows/static-analysis.yml. All tools run on
#   the same paths to ensure consistency between local and CI environments.
#
#   Tool Scope Mapping:
#   - Ruff (lint/format): src/ tests/     [matches CI: ruff check src tests]
#   - MyPy (type check):  src/            [matches CI: mypy src]
#   - Bandit (security):  src/            [matches CI: bandit -r src]
#   - Standard hooks:     all files       [good practice, not in CI]
#   - Detect-secrets:     all files       [best practice, not in CI]
#
# SETUP:
#   Install pre-commit:
#     pip install pre-commit
#   Enable hooks:
#     pre-commit install
#   Run all hooks on all files (useful for onboarding):
#     pre-commit run --all-files
#
# TESTING:
#   The detect-secrets hook uses .secrets.baseline for approved secrets.
#   When the baseline is updated, commit it with your PR.
#
# CI ENFORCEMENT:
#   For additional CI enforcement, run pre-commit via GitHub Actions.
#   See .github/workflows/static-analysis.yml for the complete set of checks.
